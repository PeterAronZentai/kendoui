<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JayStorm Get Started</title>
    <link href="examples/content/shared/styles/examples-offline.css" rel="stylesheet">
    <!--<link href="styles/kendo.default.min.css" rel="stylesheet" />-->
    <link href="styles/kendo.common.min.css" rel="stylesheet">
    <link href="styles/kendo.bootstrap.min.css" rel="stylesheet" />
    <!--<link href="styles/kendo.metroblack.min.css" rel="stylesheet">-->
    <!--<link href="styles/kendo.metro.min.css" rel="stylesheet" />-->
    <script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>

    <script src="src/js/kendo.web.js"></script>
    <script src="src/js/kendo.grid.js"></script>
    <script src="src/js/kendo.pager.js"></script>
    <script src="src/js/kendo.listview.js"></script>
    <!--<script src="src/js/kendo.tabstrip.js"></script>-->
    <script src="examples/content/shared/js/console.js"></script>

    <script src="http://include.jaydata.org/datajs-1.0.3.min.js" type="text/javascript"></script>
    <script src="http://include.jaydata.org/jaydata.min.js" type="text/javascript"></script>

    <script src="jaydata-kendods.js" type="text/javascript"></script>

    <script type="text/javascript" charset="utf-8">
        //var apiKey = {
        //    appId: '133e0907-f70b-4f11-92b3-dfebc9bdd6db',
        //    // see https://dashboard.jaystack.com for your real application key
        //    applicationKey: 'XXXX',
        //    serviceName: 'mydatabase',
        //    license: 'business'
        //};
        
        //$data.initService(apiKey).then(function (mydatabase, factory, type) {
        //    $(function () {
        //        startApplication(mydatabase);
        //    });
        //});
        $data.service("/NorthwindService.svc", function (f, t) {
            var db = f();
            $.when(db.onReady(),$.ready).then(startApplication);
        });
    </script>
    <script>
        var ct = kendo.data.Model.define({
            fields: {
                b: { type: "number" },
                c: { type: "number" }
            }
        });
        var model = kendo.data.Model.define({
            id: "ID",
            fields: {
                ID: { type: "number" },
                Name: { type: "string" },
                X: { type: "object" }
            }
            //,
            //init: function () {
            //    kendo.data.Model.fn.init.apply(this, arguments);
            //    console.log("model inited");
            //}
        });
        var model2 = kendo.data.Model.define({
            fields: {
                a: { type: "number" }
            },
            fn: function () { console.log("type fn:", arguments); }
        });

        var items = new kendo.data.ObservableArray([new model2({
            a: 1,
            fn: function () { console.log("instance fn:", arguments); return "instance fn"; }
        }),
            new model2({ a: 1 })], model2);

        var x = new model({
            ID: 1, Name: 'Z'
            , X: items,
            fn: function () { console.log("root fn:", arguments); return "root fn"; }
        });

        function startApplication(mydatabase) {
            console.dir(mydatabase);
            $('#grid').kendoGrid({
                pageable: true,
                dataSource: mydatabase.Products.asKendoDataSource()
            });
            //var _ds = mydatabase.Flowers.asKendoDataSource({ pageSize: 5 });
            //$("#listView").kendoListView({
            //    dataSource: _ds,
            //    template: kendo.template($("#template").html())
            //});
            //$("#pager").kendoPager({
            //    dataSource: _ds
            //}).data("kendoPager");
        }
        //$(function () {
        //    kendo.bind($('#mvvm'), x);
        //});
    </script>
</head>
<body>
    <div id="pager">

    </div>
    <div id="mvvm">
        <div data-bind="text: Name"></div>
        <table>
            <tbody data-template="row-template" data-bind="source: X"></tbody>
        </table>
    </div>
    <script id="row-template" type="text/x-kendo-template">
        <tr>
            <td data-bind="text: a"></td>
            <td> <a href="javascript:" data-bind="click: fn">!!</a></td>
        </tr>
    </script>
    <div id="listView"></div>
    <div id="grid">

    </div>
    <script type="text/x-kendo-tmpl" id="template">
        <div class="product" style="width:300px;float:left">
            <img style="width:250px;height:150px" src="${ImageUrl}" />
            <h3>${Name}</h3>
            <b>${kendo.toString(Price, "c")}</b>
        </div>
    </script>

</body>
</html>
